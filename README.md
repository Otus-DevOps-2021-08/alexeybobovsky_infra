# Практические работы по курсу **DevOps практики и инструменты** (alexeybobovsky_infra)
## Содержание

2. [Настройка локального окружения и практика ChatOps.](#lab_ChatOps) 
3. [Запуск VM в Yandex Cloud, настройка SSH подключения, настройка SSH подключения через Bastion Host, настройка VPN сервера и VPN-подключения.](#lab_bastion)

## Настройка локального окружения и практика ChatOps<a name="lab_ChatOps"></a>

### План работы
* Закрепляем знания по Git, работаем в своих репозиториях, созданных
после выполнения ДЗ№1
* Создаем интеграцию с чатом для вашего репозитория и подключение
Github Actions
### Практические задачи
Описание отсутствует
## Запуск VM в Yandex Cloud, настройка SSH подключения, настройка SSH подключения через Bastion Host, настройка VPN сервера и VPN-подключения.<a name="lab_bastion"></a>
### План работы 
* Создание учетной записи в Yandex.Cloud
* Создание в веб-интерфейсе инстансов ВМ и подключение к ним по SSH
* Организация подключений к хостам через бастион-хост и VPN
### Практические задачи  

Конфигурация тестового стенда:
```
bastion_IP = 62.84.118.41 
someinternalhost_IP = 10.128.0.27
```

#### Создание *прямого* ssh подключения к хосту в облаке без внешнего IP адреса (самостоятельное задание)   
Для организации требуемого подключения используем так называемый **SSH-Jump Server** ( *ssh -J* ) в качестве которого выступает хост в лблаке с *белым* ip - **bastion**. 
Такое подключение можно реализовать набрав в удалённом терминале команду 
```
ssh -i ~/.ssh/appuser -A -J appuser@62.84.118.41 appuser@10.128.0.27
```
Для создания подключения без указания промежуточного хоста нужно добавить следующие директивы в конфигурации ssh подключений **~/.ssh/config**:
```
Host bastion
    HostName 62.84.118.41
    User appuser
    IdentityFile ~/.ssh/appuser
    ForwardAgent yes
Host int
    HostName 10.128.0.27
    User appuser
    IdentityFile ~/.ssh/appuser
    ForwardAgent yes
    ProxyJump bastion
```

После этого для подключения к внутреннему хосту достаточно набрать его алиас:

```
ssh int
```

#### Установка и настройка VPN сервера PRITUNL. Создание файла для подключения к VPN.  (Основное задание)

Для установки PRITUNL пришлось изменить адрес репозитория в предложенном файле [setupvpn.sh](https://github.com/Otus-DevOps-2021-08/alexeybobovsky_infra/VPN/setupvpn.sh) (c *xenial* на *bionic*), т.к. иначе  установка завершалась ошибкой. Также пришлось дополнительно устанавливать *iptables* для корректной настройки и старта VPN. 

Для подключения в VPN сгенерён файл [cloud-bastion.ovpn](https://github.com/Otus-DevOps-2021-08/alexeybobovsky_infra/VPN/cloud-bastion.ovpn)

#### Реализация использования  валидного  SSL сертификата  для  панели  управления  VPN сервера PRITUNL (Дополнительное задание)

Для бесплатной генерации SSL серта традиционно еспользуется сервис **letsencrypt.org**. Ограничение использования при котором требуется зареганный домен обходится использованием сервиса **sslip.io**. В вебморде **PRITUNL** в настройках указывается домен **62.84.118.41.sslip.io** и сервис самостоятельно проходит проверку владения доменом, получает сертификат от letsencrypt и подкладывает его в нужное место, после чего при обращениии из браузера по [этому](https://62.84.118.41.sslip.io) адресу  предупреждения о возможно опасном содержимом уйдут.

